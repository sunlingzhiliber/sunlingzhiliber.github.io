---
layout:     post
title:      Model封装
subtitle:   太湖污染物同化模拟模型与裂隙岩溶含水层地下水模型
date:       2018-07-10
author:     Liber Sun
header-img: img/post-basic.jpg
catalog: trues
tags:
    - OpenGMS
---

# 太湖污染物同化模拟模型

![污染物同化模拟图](/img/content/taihu.jpg)

## 模型介绍

请参考 **基于粒子滤波的太湖水质同化模拟研究_郑诗晨.caj** 与 **太湖污染物同化模拟系统说明文档20150707 v2.0.0.pdf**

## 文件夹结构

模型运行需要同一个目录下的两个文件夹`\run`和`\output`。

```cmd
\run 用于存放模型本身和输入参数文件
╠═ taihu_run.dat
╠═ taihu_cor.dat
╠═ taihu_grd.dat
╠═ taihu_dep.dat
╠═ taihu_bfw.dat
╠═ taihu_its.dat
╠═ taihu_mc.dat
╠═ taihu_obc.dat
╠═ taihu_riv.dat
╠═ taihu_riv_wqm.dat
╠═ taihu_spg.dat
╠═ windstation.dat
╠═ lag.dat
╠═ COD.dat
╚═ us_fvcom.exe
```

```cmd
\output 用于存放模型运行的结果文件
╠═ taihu_topo.dat
╠═ lag_out.dat
╠═ outtaihu_prt.dat
╠═ outtaihu_tsr.dat
╚═ outtaihu_plt.dat
```

## 如何运行

- 确保程序的所有输入文件都在`run` 文件夹下
- 配置好输入数据之后，点击放置于`\run`文件夹下的`us_fvcom.exe`运行程序。
- 程序的所有输出结果将存放在output文件夹下

## 重点数据详解

- taihu_topo.dat

>记录了模型计算后得到的各种属性值，一个时刻的数据记录完毕后，再按照同样的方式记录下一时刻，一个时刻的数据组织方式如下：

```cmd
第1行：VARIABLES = "X","Y","h","el","u1","v1","u2","v2","ua","va",“COD"…
第2行：Zone n = n, e = m, f = feblock, et = triangle VARLOCATION = ([5-10]=CELLCENTERED)
第3行：x(1) x(2) …… x(n)
第4行：y(1) y(2) …… y(n)
第5行：h(1) h(2) …… h(n)
第6行：el(1) el(2) …… el(n)
第7行：u1(1) u1(2) …… u1(m)
第8行：v1(1) v1(2) …… v1(m)
第9行：u2(1) u2(2) …… u2(m)
第10行：v2(1) v2(2) …… v2(m)
第11行：ua(1) ua(2) …… ua(m)
第12行：va(1) va(2) …… va(m)
第13行：c(1) c(2) …… c(n)
第14行：va(1) va(2) …… va(m)
第15行：v(11) v(12) v(13)
第15行：v(21) v(22) v(23)
……
第m+14行：v(m1) v(m2) v(m3)
…………
```

1. n表示节点数，m表示网格数，x(i)、y(i)、h(i)、c(i)分别表示第i个节 点的坐标、水位、水质参数浓度值 ，长度单位为米，浓度单位为毫克每升。
2. u1(i)和v1(i)表示第i个网格单元表层的流速分量，与此对应，u2、v2表示底层流速，ua、va表示平均流速，v(ij)表示第i个网格第j个顶点的索引号;速度单位为米每秒。

- 其他参数请参照 **模型介绍.pdf**

## 封装策略

1.从模型容器获取输入数据，将输入数据拷贝到`模型实例文件夹`
2.从模型部署包中拷贝相关资源（包括模型实体，和依赖资源）到 `模型实例文件夹`
3.构建具体的 `模型实例文件夹`，**注意在构建时，要严格匹配，模型本身的运行文件夹要求**。
4.运行模型实体，获取模型输出数据
5.将模型输出数据返回到模型容器

## 可视化研究

主要是借助进哥的数据后处理，将taihu_topo.dat，裁剪为多个JSON文件，再利用ThreeJS，对JSON文件中存储的数据进行可视化。
涉及到的JSON数据主要包括：

```text
speed_end.json 箭头的终点
speed_start.json 箭头的起点
speed_end_up.json  顶层流速场
speed_start_up.json 顶层流速场
speed_end_down.json 底层流速场
speed_start_up.json 底层流速场
grid.json 每个格网对应的三个节点序列
xs.json 节点的横坐标
ys.json 节点的纵坐标
color.json 每个时刻的，每个节点的污染所对应的色带值
```

## Model Metadata

FirstName:Fei
LastName: Guo
Email:guofei@njnu.edu.cn

Reserach Area: 主要从事虚拟地理环境三维建模模拟与GIS应用研究。已完成国家自然科学基金“城市软土地区工程沉降建模模拟研究” （40801147）与国家高科技发展研究计划“863”专项“基于非流形理论的地下空间实体三维GIS关键技术研究（2007AA12Z236）”（副组长）的研究工作；参与了 “城市地下三维空间多源数据融合研究”（40471101）、“面向地学机理与过程模拟分析的三维空间数据模型”（40671147）、“面向地理问题求解的分布式地理建模环境研究”（40730527）、“浅海潮流振荡边界层动力特性及悬沙垂直分布研究”（41076008）等多项国家自然科学基金课题的研究工作；负责国家科技支撑计划重点项目“基于环境一号等国产卫星的大型水体环境遥感监测应用技术与软件开发”（2008BAC34B05）与国家科技重大专项“国家水环境遥感技术体系研究与示范”（2009ZX07527-006）、“高分饮用水源地遥感监测与评价”（05-Y30B02-9001-13/15-6）中大型水体污染物运移扩散模拟的研究工作。 
模型开发完成时间：未知
模型所属类别：水圈
模型标签：太湖水质，FVCOM，数据同化，粒子滤波，水质模拟
版本号：未知
各版本的描述：未知

模型功能描述：
湖泊及其流域地区是社会经济可持续发展和人类赖以生存的物质基础。太湖是我们五大淡水湖之一，在调节流域水资源、抗旱防洪、维护生态平衡等方面有着不可替代的作用。近些年随着太湖区域经济的快速发展，大量污水排入太湖，导致太湖水质问题十分突出，对太湖水质污染的治理已经是当务之急。
本模型将数据同化方法用于太湖水质预测实际应用中，采用粒子滤波方法结合三维水动力与水质模型，构建基于粒子滤波方法的太湖水质参数同化模拟模型。并开展太湖水质参数时空分布同化模拟实验，以分析同化模拟方法的精度，研究适合于太湖水质参数数值模拟的数据同化系统，模拟太湖水体中水质参数的时空分布变化，实现对太湖水质实时的跟踪模拟与预测。

模型模块信息：

- 预处理模块：模型计算之前需要进行数据预处理,对模型计算过程中所需数据进行整理和组织。

水体污染扩散模型需要水底地形、污染物状况、水流状况和物理参数等数据。
其中,水底地形由自适应流场三角网文件获得。 
污染物状况通过对太湖内岛监测站点的实测数据或遥感反演数据进行内插计算获得。
水流状况主要考虑风应力、入河河口流量和污染物通量。
物理参数包括糙率、科氏力、生物降解系数、水平紊动扩散系数。

- 数值模拟模块：由于太湖区域边界复杂，在考虑太湖水动力和水质机理的情况下，选用成熟的FVCOM模型作为数值模拟模型作为太湖水质模拟与预测的数值计算模型。

- 同化模块：由于湖泊水动力和水质机制演化过程非常复杂，且数值模型参数较多，数据无法完善的获取，致使模拟结果存在一定的误差，难以精确模拟。利用数据同化方法能够根据现场实测数据对数值模型的模拟过程进行实时矫正，使其更精确体现水动力和水质参数的分布规律。考虑到粒子滤波方法可适应于任意非线性非高斯系统，能更好的表现非线性系统的变化信息，且粒子滤波中没有复杂的矩阵转置、求逆运算等，算法简单易于实现，计算效率较高，因此采用粒子滤波的方法作为同化模拟模型。

模型应用情景：
利用数据同化方法，结合水体动力学数值模型，开展基于数据同化方法的数值模型模拟的研究。以太湖为研究区，将粒子滤波方法与FVCOM模型耦合，实现太湖水质的时空同化模拟分析。

# Groundwater Model Simulation Based on Dynamic Constraints

![Groundwater Model Simulation Based on Dynamic Constraints](/img/content/fvcom.jpg)

## 原始模型使用说明

TODO

## 文件夹结构

模型运行简单，只需要将模型本身和输入数据放置到同级目录即可完成模型运行

```text
input:
╠═ pumpn.dat 抽水节点 11个时刻，每个时刻的抽水量 共52个抽水节点
╠═ pumpe.dat 抽水井 11个时刻，每个时刻的抽水量 共8个抽水井
╠═ coef1.dat 分区含水层-导水系数 共23个分区 ?有两列
╠═ coef2.dat 分区含水层-给水度系数、越流系数 共29个分区 ?只有一列
╠═ ufield.dat 三角网所在coe2f区的编号 共1018个三角网
╠═ tfield.dat 三角网所在coef1区的编号 共1018个三角网
╠═ tstep.dat 计算时间间隔 共10个时间间隔
╠═ elen.dat 三角网的节点id号（逆时针） 共1018个三角网
╠═ h0.dat 节点的坐标和初始水位 共577个节点
╠═ obwell.dat 观测井 11个时刻，每个时刻的观测水位 共12个观测井
╠═ rain.dat 分区-降雨量 共10个分区
╠═ alfa.dat 分区-降雨入渗补给系数 共29个分区
╠═ palfa.dat 三角网所在alfa区的编号 共1018个三角网
╠═ h_up.dat 节点 10个时刻的剩余水头值 共 577个节点
╠═ pbelta.dat 三角网 所在越流分区的编号 共1018个三角网
╠═ belta.dat 分区-越流系数 共29个分区
╠═ hb1.dat 一类边界 节点+水位值（10个时刻） 一类边界有15个节点
╠═ qb1.dat 一类边界元素id号 一类边界有12个节点
╠═ qb2.dat 二类边界 节点+水位值（10个时刻） 二类边界有43个节点
exe:
╠═ undergroudwatermodel.exe
output:
╠═ herr.txt 12个观测孔各个时刻模拟误差文件
╠═ balance.txt 水均衡文件，用来观测一二类边界进出水量，各个时间段降雨量，抽水井的抽水量
╠═ out.dat
╠═ hadj.dat
╚═ calc.dat
```

## 如何运行

直接点击几何属性约束地下水模型.exe，即可完成运行

## 重点数据详解

略

## 封装策略

1.从模型容器获取输入数据，将输入数据拷贝到`模型实例文件夹`
2.从模型部署包中拷贝相关资源（包括模型实体，和依赖资源）到`模型实例文件夹`
3.构建具体的`模型实例文件夹`，*注意在构建时，要严格匹配，模型本身的运行文件夹要求*。
4.运行模型实体，获取模型输出数据
5.将模型输出数据返回到模型容器

## 可视化研究

略

## Model Metadata

FirstName:Fei
LastName: Guo
Email:guofei@njnu.edu.cn
Reserach Area: 主要从事虚拟地理环境三维建模模拟与GIS应用研究。已完成国家自然科学基金“城市软土地区工程沉降建模模拟研究” （40801147）与国家高科技发展研究计划“863”专项“基于非流形理论的地下空间实体三维GIS关键技术研究（2007AA12Z236）”（副组长）的研究工作；参与了 “城市地下三维空间多源数据融合研究”（40471101）、“面向地学机理与过程模拟分析的三维空间数据模型”（40671147）、“面向地理问题求解的分布式地理建模环境研究”（40730527）、“浅海潮流振荡边界层动力特性及悬沙垂直分布研究”（41076008）等多项国家自然科学基金课题的研究工作；负责国家科技支撑计划重点项目“基于环境一号等国产卫星的大型水体环境遥感监测应用技术与软件开发”（2008BAC34B05）与国家科技重大专项“国家水环境遥感技术体系研究与示范”（2009ZX07527-006）、“高分饮用水源地遥感监测与评价”（05-Y30B02-9001-13/15-6）中大型水体污染物运移扩散模拟的研究工作。 

模型开发完成时间：未知
模型所属类别：水圈
模型标签：地下水模型模拟；几何特征约束；属性特征约束；动态网格
版本号：未知
各版本的描述：未知

模型功能描述：
地下水数值模型是刻画、表征和再现地下水系统的一种有效工具和常用手段，它能够模拟地下水系统特征，以及解决在复杂水文地质条件和地下水开发利用条件下的地下水资源评价问题。在进行地下水模型模拟时，通常将研究区域含水层离散为网格单元，网格剖分往往只顾及研究区域的空间几何特征，对属性数据考虑不足；其次，在进行地下水模型模拟时，模拟的外界条件是变化的，而模型模拟过程空间离散网格一成不变，初始建立的网格不能很好的反映属性数据的变化特征。

针对地下水模型模拟过程中存在的上述问题，开展了在网格剖分时引入属性特征约束条件，通过模型模拟的属性特征约束构建网格剖分时的尺寸控制场，开展基于几何和属性特征约束的三角网剖分算法研究。
并进行不同空间离散网格条件下的地下水模型模拟模型，验证了基于几何和属性特征约束下的三角网生成算法在地下水模型模拟的优越性。
另外针对模型模拟外部条件的改变，综合考虑水文地质模型的几何空间特征和内部属性数据的动态变化过程，通过特征约束集合映射与更新来开展地下水模型模拟实验。

1)基于几何和属性特征约束的二维`AFT`网格剖分
基于推进波前法，综合考虑几何特征约束和属性特征约束，在几何特征约束的基础上，引入属性特征约束来获取网格剖分时的背景网格，构建网格剖分尺寸控制场进而控制网格单元大小，最终生成综合考虑了几何和属性约束的网格。

2)不同特征约束的离散网格
地下水模型数据文件配置方案，开展不同特征约束网格下的地下水模型模拟。

3)动态约束
对地下水模型模拟过程中模拟条件的变化，获取约束条件改变下的离散网格，进行模型模拟实验

模型模块信息：
（1）地下水模型模拟几何和属性特征约束映射及配置地下水模型模拟时，研究区域的数据包括水文地质、基础地质等数据，几何和属性特征约束隐含其中。首先根据获取到的数据对研究区域进行概化；然后根据概化的模型对研究区域的数据进行识别分析，从而提取研究区的几何和属性信息；最后对识别的信息进行映射配置获取网格剖分所需约束集合。
（2）基于几何和属性特征约束的研究区网格剖分
在对数据进行预处理映射获得初始特征约束集合后，本文在分析几何和属性特征约束的基础上，指定网格剖分时的最大最小尺寸，同时以指定的属性因子作为尺寸控制因子来构建网格剖分时的尺寸控制场。于此，进行几何和属性特征约束的
研究区域网格剖分。
（3）地下水模型模拟数据配置
在对研究区域网格离散后，进行点要素配置、线要素配置和面要素配置，进而对模型的模拟初始数据进行配置以获取模型模拟所需要的数据文件。
（4）基于几何和属性约束下的地下水模型模拟实验
在网格剖分算法以及地下水模型数据配置方案的基础上，本文进行了不同特征约束条件的地下水模型模拟实验，来验证几何和属性特征约束下的网格剖分算法在地下水模型模拟中的优越性。
（5）基于动态约束的地下水模型模拟实验
根据上述研究，针对模型模拟过程中研究区域外界条件动态改变的问题，本文进行基于约束集合改变的地下水模型模拟实验，探究基于动态约束的地下水模型模拟的可行性。
![技术路线](/img/content/way.png)

模型应用情景：
本文研究区为徐州裂隙岩溶含水层区域，其位于徐州低山丘陵区。西与湖西冲击平原相邻，至车辐山——岱山——单集——占城——张圩——岚山一线，包括徐州市市区、铜山县中东部地区、贾汪区及邳州和睢宁县的西部地区，面积为2904.2km2。由低山丘陵及山前、山间平原组成，地形起伏大，水文地质条件比较复杂，兼具山区和平原区的水文地质特征。徐州裂隙岩溶含水层区域一部分是裸露半裸露的岩溶丘陵，而另一部分为浅埋于第四系冲积层下的隐伏岩溶区。

基于AFT三角剖分算法，以选取的属性数据作为网格尺寸控制因子，通过引入背景网格构建网格剖分尺寸控制场，在空间离散网格的基础上进行了顾及不同特征约束下的地下水模型模拟实验。针对模型模拟外界条件的改变，本文进行了动态约束的地下水模型模拟实验