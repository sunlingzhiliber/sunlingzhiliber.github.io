---
layout:     post
title:      Tomcat
date:       2018-07-10
author:     Liber Sun
header-img: img/post-basic.jpg
catalog: Web服务器
---

Tomcat是一款开源的应用服务器，凭借技术先进、性能稳定、体积小巧、扩展性好，深受开发人员和软件开发商的认可。

# Tomcat顶层架构

![Tomcat架构](https://raw.githubusercontent.com/sunlingzhiliber/imgstore/master/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181107184142.jpg)

Tomcat中最顶层的容器是server，代表整个服务器。
然后是Service，用于提供具体服务，一个Server包含多种Service。

Service主要包括两个部分：Connector和Container。

>Connector用于处理连接相关的事情，并提供Socekt与Request、Response相关的转化。
>Container用于封装和管理Servlet，并完成具体的Request请求。

注意Service可以拥有多个Connector，因为一个服务可以有多个连接，如同时提供Http和Https链接。

## connector

![Connector结构图](https://raw.githubusercontent.com/sunlingzhiliber/imgstore/master/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181107185532.jpg)

Connector使用ProtocolHandler来处理请求的，不同的ProtocolHandler代表不同的连接类型，比如：Http11Protocol使用的是普通Socket来连接的，Http11NioProtocol使用的是NioSocket来连接的。

其中ProtocolHandler由包含了三个部件：Endpoint、Processor、Adapter。

1）Endpoint用来处理底层Socket的网络连接，Processor用于将Endpoint接收到的Socket封装成Request，Adapter用于将Request交给Container进行具体的处理。
2）Endpoint由于是处理底层的Socket网络连接，因此Endpoint是用来实现TCP/IP协议的，而Processor用来实现HTTP协议的，Adapter将请求适配到Servlet容器进行具体的处理。
3）Endpoint的抽象实现AbstractEndpoint里面定义的Acceptor和AsyncTimeout两个内部类和一个Handler接口。Acceptor用于监听请求，AsyncTimeout用于检查异步Request的超时，Handler用于处理接收到的Socket，在内部调用Processor进行处理。
