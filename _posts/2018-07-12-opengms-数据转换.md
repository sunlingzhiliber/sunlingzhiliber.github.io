---
layout:     post
title:      Data Mapping
date:       2018-07-10
author:     Liber Sun
header-img: img/post-basic.jpg
catalog: true
tags:
    - OpenGMS
    - UDX
---

面对众多已有的模型与数据资源，由于模型所需数据的多源异构性、数据准备与处理方法的难以复用性，导致了众多模型资源与数据资源之间的隔阂仍然存在，模拟资源的“孤岛”现象仍比较严重，进而阻碍了开放式建模的进程。
因此，开放式网络环境下，需要屏蔽模型所需数据资源的多源异构性，复用模型数据的准备与处理方法。OpenGMS在环境中引入了映射方法和重构方法。

# 映射简介

[数据映射](/resource/MapAndRefactor.zip)，实现模型需要的原始数据和UDX Schema描述的数据之间的相互转换的方法。利用数据映射，而可以将模型自定义数据，转换为结构化的UDX Data。

## 映射实现原理

Wraper读取配置文件，通过反射加载dll，获取类以及类中的方法。
因此创建一个重构方法，需要[配置文件](配置文件)，以及[重构方法DLL](DLL).
其中dll，必须至少包换两个方法，`Src2Udx(inputPath,outputPath)`与`Udx2Src(inputPath,outputPath)`，以便实现数据之间的相互转换。

## 映射配置文件

- cfg.xml
  提供给模型容器使用的，找到Wraper所在的路径

```xml
  <config>
    <type>exe</type>
    <start>MappingWraper.exe</start>
    <schema>./schema.xml</schema>
  </config>
```

- cfg_map.xml
  声明调用的DLL，以及DLL里面的类与方法

```xml
  <MappingMethodInfo name="Mapping.dll">
    <Method action="-w" name="Udx2SrcRun" class="Mapping.csvConverter" description="Udx2SrcRun">
      <Params datatype="System.String" type="in" name="srcFile" description="输入文件" schema="" />
      <Params datatype="System.String" type="out" name="outputFile" description="输出文件" schema="udx_schema.xml" />
    </Method>
    <Method action="-r" name="Src2UdxRun" class="Mapping.csvConverter" description="Src2UdxRun">
      <Params datatype="System.String" type="in" name="srcFile" description="输入文件" schema="udx_schema.xml" />
      <Params datatype="System.String" type="out" name="outputFile" description="输出文件" schema="" />
    </Method>
    <Method action="-h" name="help"  description="帮助信息">
    </Method>
    <Method action="-v" name="version"  description="版本信息">
    </Method>
    <Method action="-s" name="schema"  schema="udx_schema.xml">
    </Method>
    <Method action="-c" name="cability"  description="可访问的节点">
    </Method>
  </MappingMethodInfo>
```

## 映射DLL

在创建好配置文件后，你需要创建一个dll库，并在里面定义类名和方法名，如下图所示：

![mapDLL](/img/content/mapDLL.png)

## 映射使用方法

在准备好**配置文件**和**DLL**之后，将其拷贝到MappingWrapper.exe 的同级目录下，输入对应的`cmd`命令后即可调用重构方法 :

```cmd
MappingWraper.exe -r -f dd.tif -u rr.xml //src->udx flag=1
MappingWraper.exe -w -u dd.xml -f rr.tif //udx->src flag=0
```

## 映射部署方法

在准备好所有东西后，将其打包为`Zip`包，上传到数据容器即可。 最终的文件参考目录如下：

![mapDir](/img/content/mapDir.png)

# 重构简介

[重构](/resource/MapAndRefactor.zip)实现了多种数据之间的转换。

## 重构实现原理

Wraper读取配置文件，通过反射加载dll，获取类以及类中的方法。
因此创建一个重构方法，需要[配置文件](配置文件)，以及[重构方法DLL](DLL).

## 重构配置文件

- cfg.xml
  提供给模型容器使用的，找到Wraper所在的路径

```xml
  <config>
    <type>exe</type>
    <start>RefactorWraper.exe</start>
    <schema>./schema.xml</schema>
  </config>
```

- cfg_refactor.xml
  声明调用的DLL，以及DLL里面的类与方法

```xml
  <RefactorMethodInfo name="GridTest.dll">
    <Method name="gridInvdist" class="GridTest.Grid" description="gridInvdist">
      <Params datatype="System.String" type="in" name="srcFile" description="输入文件" schema="./udx_schema.xml" />
      <Params datatype="System.String" type="out" name="outputFile" description="输出文件" schema="./udx_schema.xml" />
    </Method>
  </RefactorMethodInfo>
```

## 重构DLL

在创建好配置文件后，你需要创建一个dll库，并在里面定义类名和方法名，如下图所示：

![refactorDLL](/img/content/refactorDLL.png)

## 重构使用方法

在准备好**配置文件**和**DLL**之后，将其拷贝到RefactorWrapper.exe 的同级目录下，输入对应的`cmd`命令后即可调用重构方法 :

```cmd
RefactorWraper.exe methodName params...
```

## 重构部署方法

在准备好所有东西后，将其打包为`Zip`包，上传到数据容器即可。 最终的文件参考目录如下：
![refacotrDir](/img/content/refacotrDir.png)